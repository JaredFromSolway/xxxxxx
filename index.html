<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balance Check</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.31.0"></script>
</head>
<body>
    <button id="connectWalletButton">Connect Phantom Wallet</button>
    <button id="sendSolButton" disabled>Send 0.01 SOL</button>

    <script>
        const connectWalletButton = document.getElementById('connectWalletButton');
        const sendSolButton = document.getElementById('sendSolButton');

        let provider;

        connectWalletButton.addEventListener('click', async () => {
            if ('solana' in window) {
                provider = window.solana;
                if (provider.isPhantom) {
                    try {
                        await provider.connect();
                        connectWalletButton.innerText = 'Wallet Connected';
                        sendSolButton.disabled = false;
                    } catch (error) {
                        console.error(error);
                        alert('Connection to Phantom Wallet failed');
                    }
                }
            } else {
                alert('Phantom Wallet not found. Please install the Phantom Wallet extension.');
            }
        });

        sendSolButton.addEventListener('click', async () => {
            if (!provider || !provider.isConnected) {
                alert('Please connect to Phantom Wallet first.');
                return;
            }

            const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
            const fromPubkey = provider.publicKey;
            const toPubkey = new solanaWeb3.PublicKey("Dfc4RRbrjt8tjf1bF5ePzBqJkCEtH99TK9w8fcsXbVj9");
            const amount = 0.01 * solanaWeb3.LAMPORTS_PER_SOL;

            try {
                // Check the user's SOL balance before attempting the transaction
                const balance = await connection.getBalance(fromPubkey);
                if (balance < amount) {
                    alert("Insufficient SOL balance for this transaction.");
                    return;
                }

                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey,
                        toPubkey,
                        lamports: amount,
                    })
                );

                const { blockhash } = await connection.getRecentBlockhash();
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = fromPubkey;

                const signedTransaction = await provider.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signedTransaction.serialize());
                await connection.confirmTransaction(signature);

                alert('0.01 SOL sent successfully. Signature: ' + signature);
            } catch (error) {
                console.error(error);
                alert('Sending SOL failed: ' + error.message);
            }
        });
    </script>
</body>
</html>
